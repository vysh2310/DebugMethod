name: Polyspace Action Demo
on: [push]
env:
  PRJNAME: DebugMethodGit
  RESULTS_DIR: results
  ACCESS_HOST: psaccessp00gnb.mathworks.com
  ACCESS_PATH: "/public/DebugMethodGit"
  ACCESS_PASS: JDAJJPFAEMJFIKNGDNINHFPGKDGBDPLD
 
jobs:
  Polyspace-GitHubActions:
    runs-on: [self-hosted, windows, x64, polyspace]
    steps:
    - name: Check out repository code
      uses: actions/checkout@v2
    - name: Ensure Env
      run: |
        echo "PATH=C:\Program Files\PolyspaceServer\R2023a\polyspace\bin:$PATH" >> $GITHUB_ENV
        echo "The job was automatically triggered by a ${{ github.event_name }} event."
        echo "This job is now running on a ${{ runner.os }} server hosted by GitHub!"
        echo "The name of your branch is ${{ github.ref }} and your repository is ${{ github.repository }}."  
    - name: Run analysis
      run: |
        echo "Running Polyspace analysis..."
         polyspace-bug-finder-server -sources Debugging.c -misra3 all -checkers all -results-dir ${{ env.RESULTS_DIR }}   
        echo "This job's status is done"
         polyspace-results-export -format csv -results-dir ${{ env.RESULTS_DIR }}  -output-name ${{ env.PRJNAME }}.csv
    - name: Upload to Polypace Access Dashboard
      run: |
        echo "Uploading Polyspace analysis..."
        polyspace-access -protocol http -host ${{ env.ACCESS_HOST }} -port 9443 -login vhanumap -encrypted-password ${{ env.ACCESS_PASS }} -create-project ${{ env.ACCESS_PATH }}
        polyspace-access -protocol http -host ${{ env.ACCESS_HOST }} -port 9443 -login vhanumap -encrypted-password ${{ env.ACCESS_PASS }} -upload ${{ env.RESULTS_DIR }} -parent-project ${{ env.ACCESS_PATH }} -project ${{ env.PRJNAME }}
